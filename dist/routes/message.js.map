{"version":3,"sources":["../../server/routes/message.js"],"names":["dotenv","config","messageRouter","express","Router","post","senderItem","verifyToken","req","res","body","userDetails","receiverEmail","subject","message","status","receiverId","senderId","userid","then","result","length","createdOn","Date","catch","e"],"mappings":";;;;;;AAAA;;;;AAEA;;;;AACA;;AACA;;AACA;;;;AACA;;;;AALAA,iBAAOC,MAAP;;;AAOA,IAAMC,gBAAgBC,kBAAQC,MAAR,EAAtB;;AAGAF,cAAcG,IAAd,CAAmB,WAAnB,EAA+BC,sBAA/B,EAA2CC,uBAA3C,EAAwD,UAACC,GAAD,EAAKC,GAAL,EAAW;AAAA,qBACAD,IAAIE,IADJ;AAAA,SACvDC,WADuD,aACvDA,WADuD;AAAA,SAC3CC,aAD2C,aAC3CA,aAD2C;AAAA,SAC5BC,OAD4B,aAC5BA,OAD4B;AAAA,SACnBC,OADmB,aACnBA,OADmB;AAAA,SACVC,MADU,aACVA,MADU;AAAA,SAEvDC,UAFuD,GAEzCR,GAFyC,CAEvDQ,UAFuD;;AAG9D,SAAMC,WAAWN,YAAY,CAAZ,EAAeO,MAAhC;AACA,uBAASN,aAAT,EACCO,IADD,CACM,UAACC,MAAD,EAAU;AACf,cAAGA,OAAOC,MAAP,GAAgB,CAAnB,EAAqB;AACpB,mBAAML,cAAaI,OAAO,CAAP,EAAUF,MAA7B;AACA,mBAAMI,YAAY,IAAIC,IAAJ,EAAlB;AACA,sCAAcP,WAAd,EAAyBC,QAAzB,EAAkCJ,OAAlC,EAA0CC,OAA1C,EAAkDC,MAAlD,EAAyDO,SAAzD;AACA,4CAAab,GAAb,EAAiB,GAAjB,EAAqB,cAArB,EAAqC,IAArC;AACA,WALD,MAKK;AACJ,4CAAaA,GAAb,EAAiB,GAAjB,EAAqB,IAArB,EAA2B,0BAA3B;AACA;AACD,MAVD,EAUGe,KAVH,CAUS,UAACC,CAAD,EAAK;AACb,uCAAahB,GAAb,EAAiB,GAAjB,EAAqB,IAArB,EAA0B,wBAA1B;AACA,MAZD;AAcJ,CAlBD;;kBAwBeP,a","file":"message.js","sourcesContent":["import dotenv from 'dotenv';\r\ndotenv.config();\r\nimport express from 'express';\r\nimport { validateUserEntry, validateUserSignIn, verifyToken, senderItem } from '../helpers/validators';\r\nimport { sendResponse } from '../helpers/responses';\r\nimport jwt from \"jsonwebtoken\";\r\nimport { getMessageIds,getEmail, insertMessage } from '../crud/db'\r\n\r\nconst messageRouter = express.Router();\r\n\r\n\r\nmessageRouter.post('/messages',senderItem, verifyToken, (req,res)=>{\r\n     const {userDetails,receiverEmail, subject, message, status} = req.body\r\n     const {receiverId} = req\r\n     const senderId = userDetails[0].userid\r\n     getEmail(receiverEmail)\r\n     .then((result)=>{\r\n     \tif(result.length > 0){\r\n     \t\tconst receiverId = result[0].userid;\r\n     \t\tconst createdOn = new Date();\r\n     \t\tinsertMessage(receiverId,senderId,subject,message,status,createdOn)\r\n     \t\tsendResponse(res,200,'message sent', null)\r\n     \t}else{\r\n     \t\tsendResponse(res,400,null, 'Could not retrieve email');\r\n     \t}\r\n     }).catch((e)=>{\r\n     \tsendResponse(res,400,null,'cannot process request')\r\n     })\r\n     \r\n});\r\n\r\n\r\n\r\n\r\n\r\nexport default messageRouter\r\n"]}