{"version":3,"sources":["../../server/helpers/validators.js"],"names":["dotenv","config","isPositiveInteger","test","s","filterInput","input","pattern","result","trimAllSpace","str","replace","atEpicMail","match","length","validateUserEntry","req","res","next","body","email","firstName","lastName","password","undefined","trimFirstName","trimLastName","trimEmail","validator","isEmail","payload","token","jwt","sign","process","env","SECRET_KEY","then","hashedPassword","bcrypt","genSalt","err","salt","hash","catch","send","validateUserSignIn","checkEmail","user","users","filter","accountDetails","verifyToken","bearerHeader","headers","bearer","split","bearerToken"],"mappings":"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","file":"validators.js","sourcesContent":["import validator from 'validator';;\nimport { sendResponse } from './responses';\nimport { getEmail, insertUsers } from '../crud/db'\nimport bcrypt from 'bcryptjs'\nimport jwt from \"jsonwebtoken\"\nimport dotenv from 'dotenv';\n\ndotenv.config();\n// let connectionString = process.env.DATABASE_URL;\n\n\nconst isPositiveInteger = s => /^\\+?[1-9][\\d]*$/.test(s);\n\nconst filterInput = (input) => {\n  const pattern = /[~!#$%^&*()+={}:'\"<>?;',]/;\n  const result = pattern.test(input);\n  return result;\n};\n\nconst trimAllSpace = str => str.replace(/\\s+/g, '');\n\nconst atEpicMail = (input) => {\n  const result = input.match(/@epicmail.com/g)\n  if(result === null){\n  \treturn false;\n  }else if(result.length > 0){\n  \treturn true;\n  }\n};\n\n\nconst validateUserEntry = (req, res, next) => {\n  const {\n    email, firstName, lastName, password,\n  } = req.body;\n\n  if(email === undefined || firstName === undefined || lastName === undefined || password === undefined){\n    sendResponse(res, 400, null, \"Ensure that all fields are correctly filled out\")\n  }else{\n      const trimFirstName = trimAllSpace(firstName);\n      const trimLastName = trimAllSpace(lastName);\n      const trimEmail = trimAllSpace(email);\n        if (validator.isEmail(email) && atEpicMail(trimEmail) && !filterInput(trimFirstName) && trimFirstName.length > 2\n    && !filterInput(trimLastName) && trimLastName.length > 2\n    && !filterInput(trimEmail) && password.length > 6) {\n    const {firstName, lastName, email, password} = req.body;\n    const payload = {\n      firstName,\n      lastName,\n      email\n    }\n    const token = jwt.sign(payload, process.env.SECRET_KEY);\n    req.token = token;\n    getEmail(email)\n   .then((result)=>{\n      if(result.length > 0){\n          sendResponse(res, 400, null, 'Not allowed to sign up');\n      }else{\n         const hashedPassword = bcrypt.genSalt(10, (err,salt)=>{\n            bcrypt.hash(password,salt,(err,hash) =>{\n              insertUsers(firstName,lastName,email,hash,token);\n              next();\n            })\n         });\n         \n      }\n   }).catch((err)=>{\n      res.send(err);\n   });\n        \n    } else {\n      sendResponse(res, 400, null, 'Ensure username, email and password are valid entries');\n    }\n  }\n\n} \n\n\n\n\nconst validateUserSignIn = (req, res, next) => {\n  const { email, password } = req.body;\n  const trimEmail = trimAllSpace(email);\n  if (validator.isEmail(email) && !filterInput(trimEmail) && password.length > 6) {\n    const checkEmail = user.users.filter(result => result.email === email);\n\n    if (checkEmail.length > 0 && checkEmail[0].password === password) {\n      req.accountDetails = checkEmail[0];\n      next();\n    } else {\n      sendResponse(res, 400, null, 'email and password is not associated with a registered account');\n    }\n  } else {\n    sendResponse(res, 400, null, 'Ensure email and password are valid entries');\n  }\n};\n\n\n\n\n//FORMAT OF TOKEN\n//Authorizarion: Bearer <access_token>\n\n//verify Token\nconst verifyToken = (req, res, next) => {\n  //Get auth header value\n  const bearerHeader = req.headers['authorization'];\n\n  //check if bearer header is undefined\n  if(typeof bearerHeader !== 'undefined'){\n     //Split at the space\n     const bearer = bearerHeader.split(' ');\n\n     //Get token from array\n     const bearerToken = bearer[1];\n\n     //Set the token\n     req.token = bearerToken;\n\n     //Next middleware\n     next();\n  }else{\n    sendResponse(res,404,null, 'forbidden');\n  }\n}\n\n\n\nexport {\n  isPositiveInteger,filterInput,trimAllSpace,validateUserEntry,validateUserSignIn,verifyToken,atEpicMail};\n"]}